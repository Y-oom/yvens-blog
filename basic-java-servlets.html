<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="/favicon.ico"> <title>[JAVA] Java Servlet 基础简介 - Out of Memory</title> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet"> <link rel="stylesheet" href="/assets/dist/css/style.css"> <!-- <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_big-stone.min.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_white.min.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-base16.dark.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-github.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[JAVA] Java Servlet 基础简介 | Out of Memory</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="[JAVA] Java Servlet 基础简介" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="本文转译自 Guide to Java Servlets，有部分增删和修改。有兴趣的可以直接阅读原文。" /> <meta property="og:description" content="本文转译自 Guide to Java Servlets，有部分增删和修改。有兴趣的可以直接阅读原文。" /> <link rel="canonical" href="https://outofmemory.blog/basic-java-servlets.html" /> <meta property="og:url" content="https://outofmemory.blog/basic-java-servlets.html" /> <meta property="og:site_name" content="Out of Memory" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2019-07-20T00:00:00+08:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="[JAVA] Java Servlet 基础简介" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-07-20T00:00:00+08:00","datePublished":"2019-07-20T00:00:00+08:00","description":"本文转译自 Guide to Java Servlets，有部分增删和修改。有兴趣的可以直接阅读原文。","headline":"[JAVA] Java Servlet 基础简介","mainEntityOfPage":{"@type":"WebPage","@id":"https://outofmemory.blog/basic-java-servlets.html"},"url":"https://outofmemory.blog/basic-java-servlets.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="content"> <header> <div class="main"> <a href="https://outofmemory.blog/">Out of Memory</a> </div> <nav> <a class='' href="/">首页</a> <!-- <a class='' href="/archives.html"> Archives</a> --> <a class='' href="/about.html">关于</a> </nav> </header> <hr class="light-hr"> <main> <div class="title"> <h1 class="title">[JAVA] Java Servlet 基础简介</h1> <div class="meta"> <time datetime="20-07-2019">Jul 20 2019</time> </div> </div> <hr class="no-margin light-hr "> <blockquote> <p>本文转译自 <a href="https://howtodoinjava.com/java/servlets/complete-java-servlets-tutorial/" target="_blank">Guide to Java Servlets</a>，有部分增删和修改。有兴趣的可以直接阅读原文。</p> </blockquote> <p>Java Servlet 是一些遵从 <strong>Java Servlet API</strong> 的 Java 类，这些 Java 类可以响应请求。尽管 Servlet 可以响应任意类型的请求，但是它们使用最广泛的是响应 Web 请求。 Java Servlet 也必须部署在 Servlet 容器才能使用。 Servlet 容器是一个运行在 Web 服务器上的组件，它负责管理 Servlets 的生命周期，接收客户端请求，调用相应的 Servlet 方法，并将响应发送回客户端。常见的 Servlet 容器有 <a href="https://github.com/apache/tomcat" target="_blank">Tomcat</a>、<a href="https://github.com/eclipse/jetty.project" target="_blank">Jetty</a>、<a href="https://www.oracle.com/middleware/technologies/glassfish-server.html" target="_blank">GlassFish</a> 等。</p> <p>虽然很多开发者都使用 <a href="https://zh.wikipedia.org/wiki/JSP" target="_blank">Java Server Pages（JSP）</a>和 <a href="https://zh.wikipedia.org/wiki/JavaServer_Faces" target="_blank">Java Server Faces（JSF）</a>等 Servlet 框架，但是这些技术都要在幕后通过 Servlet 容器把页面编译为 Java Servlet。所以说了解 Servlet 对于理解 Web 开发中的基本概念和原理是很有帮助的。</p> <h2 id="the-first-servlet">The First Servlet</h2> <p>我们的第一个 Servlet 只有简单的几行代码，目的是为了让你了解如何使用它：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFirstServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>
 
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1915463532411657451L</span><span class="o">;</span>
 
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>
    <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Write some content</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;html&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;head&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;title&gt;MyFirstServlet&lt;/title&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/head&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;body&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;h2&gt;Hello World.&lt;/h2&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/body&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/html&gt;"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
   
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">//Do some other work</span>
  <span class="o">}</span>
 
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getServletInfo</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s">"MyFirstServlet"</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>为了在 Web 容器里注册上面的 Servlet，还要创建一个 web.xml 文件作为入口。</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0"?&gt;</span>
<span class="nt">&lt;web-app</span>   <span class="na">xmlns=</span><span class="s">"http://xmlns.jcp.org/xml/ns/javaee"</span>
      <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">"http://xmlns.jcp.org/xml/ns/javaee 
      http://www.oracle.com/webfolder/technetwork/jsc/xml/ns/javaee/web-app_3_0.xsd"</span>
      <span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span>

...
   
  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>MyFirstServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.demo.MyFirstServlet<span class="nt">&lt;/servlet-class&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  <span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>MyFirstServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/MyFirstServlet<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/servlet-mapping&gt;</span>

...
   
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div></div> <p>上面这个 Servlet 有以下几点需要了解和注意：</p> <ul> <li>继承了 <code class="language-plaintext highlighter-rouge">HttpServlet</code>。这个继承是必须的，所有的 Servlet 必须是要么继承了 <code class="language-plaintext highlighter-rouge">javax.servlet.GenericServlet</code> 的普通 Servlet，要么继承了 <code class="language-plaintext highlighter-rouge">javax.servlet.http.HttpServlet</code> 的 HTTP Servlet。</li> <li>重写 <code class="language-plaintext highlighter-rouge">doGet()</code> 和 <code class="language-plaintext highlighter-rouge">doPost()</code> 方法。这两个方法都已在 HttpServlet 类里定义了。当一个 GET 或 POST 请求到来时，它就会被映射到相应的方法里。例如，如果你向这个 Servlet 发送一个 GET 请求，<code class="language-plaintext highlighter-rouge">doGet()</code> 方法就会被调用。</li> <li><code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 和 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 是所有 <code class="language-plaintext highlighter-rouge">doXXX()</code> 方法的默认参数。在后面会详细介绍这些对象。</li> <li>也有一些其他有用的方法。可以重写它们来在运行时控制应用。例如 <code class="language-plaintext highlighter-rouge">getServletInfo()</code>。</li> </ul> <h2 id="servlet-life-cycle">Servlet Life Cycle</h2> <p>当你在加载并使用一个 Servlet 时，从初始化到销毁这个 Servlet 期间会发生一系列的事件。这些事件叫做 Servlet 的生命周期事件（或方法）。</p> <p>Servlet 生命周期的三个核心方法分别是 <code class="language-plaintext highlighter-rouge">init()</code>，<code class="language-plaintext highlighter-rouge">service()</code> 和 <code class="language-plaintext highlighter-rouge">destroy()</code>。每个 Servlet 都会实现这些方法，并且在特定的时间调用它们。</p> <p><code class="language-plaintext highlighter-rouge">init()</code>：在 Servlet 生命周期的初始化阶段，Web 容器通过调用 <code class="language-plaintext highlighter-rouge">init()</code> 方法来初始化 Servlet 实例，并且可以传递一个实现 <code class="language-plaintext highlighter-rouge">javax.servlet.ServletConfig</code> 接口的对象给它。这个配置对象使 Servlet 能够读取在 Web 应用的 web.xml 文件里定义的 name-value 初始参数。这个方法在整个实例的生命周期里只调用一次。</p> <p><code class="language-plaintext highlighter-rouge">init()</code> 方法大概长这样：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
	<span class="c1">//custom initialization code</span>
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">service()</code>：初始化后，Servlet 实例就可以处理客户端请求了。Web 容器调用 Servlet 的 <code class="language-plaintext highlighter-rouge">service()</code> 方法来处理每一个请求。<code class="language-plaintext highlighter-rouge">service()</code> 方法定义了能够处理的请求类型并且调用适当方法来处理这些请求。编写 Servlet 的开发者必须为这些方法提供实现。如果收到了一个 Servlet 没实现的请求，那么父类的方法就会被调用并且通常会给请求方返回一个错误信息。</p> <p>一般情况下不用重写这个方法：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">service</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span>  <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span> 
    <span class="o">...</span> 
<span class="o">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">destroy()</code>：最后，Web 容器调用 <code class="language-plaintext highlighter-rouge">destroy()</code> 方法来结束 Servlet。如果你想在 Servlet 的生命周期内关闭或者销毁一些文件系统或者网络资源，你可以调用这个方法来实现。<code class="language-plaintext highlighter-rouge">destroy()</code> 方法和 <code class="language-plaintext highlighter-rouge">init()</code> 方法一样，在整个生命周期里只能调用一次。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
	<span class="c1">//</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>在大多数情况下，都不需要在你的 Servlet 里重写这些方法。</strong></p> <h2 id="webservlet-annotation">@WebServlet Annotation</h2> <p>如果你不喜欢使用 xml 配置而喜欢注解的话，Servlets API 同样提供了一些注解接口给你。你可以像下面的例子一样使用 <code class="language-plaintext highlighter-rouge">@WebServlet</code> 注解并且不需要在 web.xml 里为 Servlet 注册任何信息，容器会将你的 Servlet 自动注册到运行环境。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MyFirstServlet"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/MyFirstServlet"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFirstServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1915463532411657451L</span><span class="o">;</span>
 
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">//Do some work</span>
  <span class="o">}</span>
   
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
    <span class="c1">//Do some other work</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="packaging-and-deploying-servlet-into-tomcat-server">Packaging and Deploying Servlet into Tomcat Server</h2> <p>如果你在使用 IDE（比如 IntelliJ IDEA），可以创建一个 webapp + Maven 项目，导入依赖(主要就是 <code class="language-plaintext highlighter-rouge">javax.servlet-api</code>)并内嵌 Tomcat ，然后创建一个运行配置(如下图)，就可以一键运行调试。</p> <center> <img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/assets/dist/images/3hl592pny.pic.jpg" id="3hl592pnypic" /> <br /> </center> <script> window.onresize = () => ce(); window.onload = () => ce(); const ce = () => { let docWidth = document.documentElement.clientWidth; let el1 = document.getElementById("3hl592pnypic"); let el2 = document.getElementById("pd3no9kwupic"); let el3 = document.getElementById("74pbqpjafpic"); if(docWidth >= 750) { el1.setAttribute('width', '75%'); el2.setAttribute('width', '65%'); el3.setAttribute('width', '65%'); } else { el1.setAttribute('width', '100%'); el2.setAttribute('width', '100%'); el3.setAttribute('width', '100%'); } }; </script> <p>如果你没在使用 IDE，那么你需要做一些额外的工作。比如，使用命令行工具编译应用，使用 ANT 去生成 war 文件等等。但我相信，现在的开发者都在使用 IDE 来开发，所以我就不在这方面浪费时间了。</p> <p>运行上面的 Servlet ，在浏览器输入”http://localhost:8080/MyFirstServlet”：</p> <center> <img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/assets/dist/images/pd3no9kwu.pic.jpg" id="pd3no9kwupic" /> <br /> </center> <h2 id="writing-to-a-servlet-response">Writing to a Servlet Response</h2> <p>Java Servlet 如此有用的原因之一是 Servlet 能动态显示网页内容。这些内容可以从服务器本身、另外一个网站、或者许多其他网络可以访问的资源里获取。Servlet 不是静态网页，它们是动态的。可以说这是它们最大的优势。</p> <p>还是这个 Servlet 例子，这个 Servlet 会显示当前日期时间和一些自定义的信息：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebServlet</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CalendarServlet"</span><span class="o">,</span> <span class="n">urlPatterns</span> <span class="o">=</span> <span class="o">{</span><span class="s">"/CalendarServlet"</span><span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalendarServlet</span> <span class="kd">extends</span> <span class="nc">HttpServlet</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1915463532411657451L</span><span class="o">;</span>
 
  <span class="nd">@Override</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">getData</span><span class="o">();</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>
    <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="c1">// Write some content</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;html&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;head&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;title&gt;CalendarServlet&lt;/title&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/head&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;body&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;h2&gt;hello "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">)</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"message"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"&lt;/h2&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;h2&gt;The time right now is : "</span> <span class="o">+</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/h2&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/body&gt;"</span><span class="o">);</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/html&gt;"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">}</span>
   
  <span class="c1">//This method will access some external system as database to get user name, and his personalized message</span>
  <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;();</span>
    <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"yven"</span><span class="o">);</span>
    <span class="n">data</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span>  <span class="s">"Welcome to my first servlet!"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>调试运行，并在浏览器输入”http://localhost:8080/CalendarServlet”：</p> <center> <img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/assets/dist/images/74pbqpjaf.pic.jpg" id="74pbqpjafpic" /> <br /> </center> <h2 id="handling-servlet-requests-and-responses">Handling Servlet Requests and Responses</h2> <p>Servlet 可以轻松创建一个基于请求和响应生命周期的 web 应用。它们能够提供 HTTP 响应并且可以使用同一段代码来处理业务逻辑。处理业务逻辑的能力使 Servlet 比标准的 HTML 代码更强大。</p> <p>实际应用中，一个 HTML 网页表单包含了要发送给 Servlet 的参数。Servlet 会以某种方式来处理这些参数并且返回一个客户端能够识别的响应。在对象是 HttpServlet 的情况下，客户端是 web 浏览器，响应是 web 页面。<code class="language-plaintext highlighter-rouge">&lt;form&gt;</code> 标签中的 action 属性指定了使用哪个 Servlet 来处理表单里的参数值。</p> <p>获取请求参数，可以调用 <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 对象的 <code class="language-plaintext highlighter-rouge">getParameter()</code> 方法，方法参数是你要获取的参数值的 id。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">value1</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"param1"</span><span class="o">);</span>
<span class="nc">String</span> <span class="n">value1</span> <span class="o">=</span> <span class="n">httpServletRequest</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"param2"</span><span class="o">);</span>
</code></pre></div></div> <p>获取到的参数值会在需要的时候处理。对客户端的响应和我们上面部分讨论的一样。我们使用 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 对象给客户端发送响应。</p> <p>一个基本的请求和响应：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
    <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
   
  <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"text/html;charset=UTF-8"</span><span class="o">);</span>
  <span class="nc">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
  <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
  <span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>
  <span class="kt">boolean</span> <span class="n">success</span> <span class="o">=</span> <span class="n">validateUser</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">password</span><span class="o">);</span>
   
  <span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Write some content</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;html&gt;"</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;head&gt;"</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;title&gt;LoginServlet&lt;/title&gt;"</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/head&gt;"</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;body&gt;"</span><span class="o">);</span>
 
    <span class="k">if</span><span class="o">(</span><span class="n">success</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;h2&gt;Welcome Friend&lt;/h2&gt;"</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;h2&gt;Validate your self again.&lt;/h2&gt;"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/body&gt;"</span><span class="o">);</span>
    <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"&lt;/html&gt;"</span><span class="o">);</span>
  <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
    <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>通常使用 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 里的 <code class="language-plaintext highlighter-rouge">PrintWriter</code> 对象给客户端发送内容。写入这个对象的内容是通过输出流返回给客户端。</p> <h2 id="listening-for-servlet-container-events">Listening for Servlet Container Events</h2> <p>有时候，知道容器里某些事件发生的时间是很有用的。这个概念适用于很多情况，但最常见的是用于在启动时初始化应用程序或在关闭应用程序后的清理工作。可以在应用里注册一个监听器来指示应用什么时候开启或者关闭。因此，通过监听这些事件，Servlet 可以在一些事件发生时执行相应的动作。</p> <p>创建基于容器事件执行动作的监听器，就必须创建一个实现 <code class="language-plaintext highlighter-rouge">ServletContextListener</code> 接口的类。这个类必须实现的方法有 <code class="language-plaintext highlighter-rouge">contextInitialized()</code> 和 <code class="language-plaintext highlighter-rouge">contextDestroyed()</code>。这两个方法都需要 <code class="language-plaintext highlighter-rouge">ServletContextEvent</code> 作为参数，在每次初始化或者关闭容器的时候都会被自动调用。</p> <p>可以通过以下几种方式注册监听器：</p> <ul> <li><code class="language-plaintext highlighter-rouge">@WebListener</code> 注解。</li> <li>在 web.xml 文件里注册监听器。</li> <li>使用 <code class="language-plaintext highlighter-rouge">ServletContext</code> 里定义的 <code class="language-plaintext highlighter-rouge">addListener()</code> 方法。</li> </ul> <p>值得注意的是，<code class="language-plaintext highlighter-rouge">ServletContextListener</code> 不是 Servlet API 里唯一的监听器。这里还有一些其他的监听器，比如：</p> <ul> <li><code class="language-plaintext highlighter-rouge">javax.servlet.ServletRequestListener</code></li> <li><code class="language-plaintext highlighter-rouge">javax.servlet.ServletRequestAttrbiteListener</code></li> <li><code class="language-plaintext highlighter-rouge">javax.servlet.ServletContextListener</code></li> <li><code class="language-plaintext highlighter-rouge">javax.servlet.ServletContextAttributeListener</code></li> <li><code class="language-plaintext highlighter-rouge">javax.servlet.HttpSessionListener</code></li> <li><code class="language-plaintext highlighter-rouge">javax.servlet.HttpSessionAttributeListener</code></li> </ul> <p>根据需要来选择实现你的监视器。比如，每当创建或销毁一个用户 <code class="language-plaintext highlighter-rouge">session</code> 时，<code class="language-plaintext highlighter-rouge">HttpSessionListener</code> 会发出通知。</p> <h2 id="passing-parameters-to-servlet-initialization">Passing Parameters to Servlet Initialization</h2> <p>现在的大多数应用都需要设置一些在应用或控制器启动时可以传递的配置参数。Servlet 也可以接受初始化参数，并在处理请求之前使用它们来构建配置参数。</p> <p>你也可以在 Servlet 里对配置值进行硬编码。但是这样做的话，在每次 Servlet 发生改动时都需要再次重新编译整个应用。</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;web-app&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>SimpleServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.demo.SimpleServlet<span class="nt">&lt;/servlet-class&gt;</span>
     
        <span class="c">&lt;!-- Servlet init param --&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>name<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>value<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
 
    <span class="nt">&lt;/servlet&gt;</span>
 
<span class="nt">&lt;/web-app&gt;</span>
</code></pre></div></div> <p>设置后，你就可以调用 <code class="language-plaintext highlighter-rouge">getServletConfig.getInitParameter()</code> 并传递参数名给该方法来使用参数，就像这样：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">getServletConfig</span><span class="o">().</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"name"</span><span class="o">);</span>
</code></pre></div></div> <h2 id="servlet-filters">Servlet Filters</h2> <p>Web 过滤器用于预处理请求和在访问给定 URL 时调用某些功能。与直接调用存在于指定 URL 的 Servlet 不同，任何包含相同 URL 模式的过滤器都会在 Servlet 之前被调用。这在许多情况下都很有帮助，也许最有用的是执行日志记录、身份验证或其他在后台无需用户交互的服务。</p> <p>过滤器必须要实现 <code class="language-plaintext highlighter-rouge">javax.servlet.Filter</code> 接口。这个接口包含了 <code class="language-plaintext highlighter-rouge">init()</code>，<code class="language-plaintext highlighter-rouge">descriptor()</code> 和 <code class="language-plaintext highlighter-rouge">doFilter()</code> 这些方法。<code class="language-plaintext highlighter-rouge">init()</code> 和 <code class="language-plaintext highlighter-rouge">destroy()</code> 方法会被容器调用。 <code class="language-plaintext highlighter-rouge">doFilter()</code> 方法用来在过滤器类里实现业务逻辑。如果你想把过滤器组成过滤链或者给定的 URL 模式存在多个过滤器，它们就会根据 web.xml 里的配置顺序被调用。</p> <p>在 web.xml 里配置过滤器，使用 <code class="language-plaintext highlighter-rouge">&lt;filter&gt;</code> 和 <code class="language-plaintext highlighter-rouge">&lt;filter-mapping&gt;</code> 标签以及相关的子元素标签。</p> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>LoggingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>LoggingFilter<span class="nt">&lt;/filter-class&gt;</span>
<span class="nt">&lt;/filter&gt;</span>
<span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>LogingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
<span class="nt">&lt;/filter-mapping&gt;</span>
</code></pre></div></div> <p>也可以使用 <code class="language-plaintext highlighter-rouge">@WebFilter</code> 注解来为特定的 Servlet 配置过滤器。</p> <h2 id="downloading-a-binary-file-using-servlet">Downloading a Binary File using Servlet</h2> <p>下载文件的功能在 Web 应用中很常见。为了下载一个文件，Servlet 必须提供一个和下载文件类型匹配的响应类型。同样，必须在响应头里指出该响应包含附件。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMimeType</span><span class="o">(</span> <span class="n">fileToDownload</span> <span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span> <span class="n">mimeType</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mimeType</span> <span class="o">:</span> <span class="s">"text/plain"</span> <span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span> <span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">fileToDownload</span> <span class="o">+</span> <span class="s">"\""</span> <span class="o">);</span>
</code></pre></div></div> <p>通过调用 <code class="language-plaintext highlighter-rouge">ServletContext.getResourceAsStream()</code> 方法并传递文件路径来获取要下载的文件的引用。这个方法会返回一个输入流对象，我们可以用这个对象来读取文件内容。当读取文件时，我们创建一个字节缓存区，从文件里获取数据块。最后读取文件内容并且把它们复制到输出流，使用 <code class="language-plaintext highlighter-rouge">while</code> 循环读取 <code class="language-plaintext highlighter-rouge">InputStream</code> 中的数据，直到处理完所有内容就会退出循环。之后 <code class="language-plaintext highlighter-rouge">ServletOutputStream</code> 对象的 <code class="language-plaintext highlighter-rouge">flush()</code> 方法就会被调用清空内容和释放资源：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">downloadFile</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> 
      <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">String</span> <span class="n">fileToDownload</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

    <span class="kd">final</span> <span class="kt">int</span> <span class="no">BYTES</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
     
    <span class="nc">ServletOutputStream</span> <span class="n">outStream</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
    <span class="nc">ServletContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">getServletConfig</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">();</span>
 
    <span class="nc">String</span> <span class="n">mimeType</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getMimeType</span><span class="o">(</span><span class="n">fileToDownload</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">mimeType</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">mimeType</span> <span class="o">:</span> <span class="s">"text/plain"</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename=\""</span> <span class="o">+</span> <span class="n">fileToDownload</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">);</span>
    <span class="nc">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"/"</span> <span class="o">+</span> <span class="n">fileToDownload</span><span class="o">);</span>
     
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bbuf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="no">BYTES</span><span class="o">];</span>
 
    <span class="k">while</span><span class="o">((</span><span class="n">in</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">length</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bbuf</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
      <span class="n">outStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bbuf</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">length</span><span class="o">);</span>
    <span class="o">}</span>
 
    <span class="n">outStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
    <span class="n">outStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
  <span class="o">}</span>
</code></pre></div></div> <h2 id="forward-request-to-another-servlet">Forward Request to Another Servlet</h2> <p>有时候，你的应用需要把一个 Servlet 要处理的请求转让给另一个 Servlet 来处理。而且，转让请求时不能发生重定向。即浏览器地址栏上的 URL 不会改变。</p> <p>在 <code class="language-plaintext highlighter-rouge">ServletContext</code> 里已经内置了实现上面需求的方法。当你获取了 <code class="language-plaintext highlighter-rouge">ServletContext</code> 的引用，你就可以调用 <code class="language-plaintext highlighter-rouge">getRequestDispatcher()</code> 方法去获取用来转发请求的 <code class="language-plaintext highlighter-rouge">RequestDispatcher</code> 对象。</p> <p>当调用 <code class="language-plaintext highlighter-rouge">getRequestDispatcher()</code> 方法时，需要传递包含 Servlet 名的字符串，这个 Servlet 就是你用来处理转让请求的 Servlet。获取 <code class="language-plaintext highlighter-rouge">RequestDispatcher</code> 对象后，通过传递 <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> 和 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 对象给它来调用转发方法。然后对请求进行转发。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">RequestDispatcher</span> <span class="n">rd</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">"/NextServlet"</span><span class="o">);</span>
<span class="n">rd</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</code></pre></div></div> <h2 id="redirect-request-to-another-servlet">Redirect Request to Another Servlet</h2> <p>有些情况下，我们又希望访问一些特定的 URL 时发生重定向，即浏览器地址栏的 URL 变成另一个。</p> <p>这时候就可以调用 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 对象的 <code class="language-plaintext highlighter-rouge">sendRedirect()</code> 方法。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">httpServletResponse</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"/anotherURL"</span><span class="o">);</span>
</code></pre></div></div> <p>这个简单的重定向，与 servlet chaining 相反，不需要传递目标地址的 <code class="language-plaintext highlighter-rouge">HttpRequest</code> 对象。</p> <h2 id="readwrite-cookies-using-servlets">Read/Write Cookies using Servlets</h2> <p>很多应用都想在客户端机器里保存用户当前的浏览历史。目的是当用户再次访问时，能够从上次离开的地方继续。通常使用 Cookies 来实现。你可以把它看作是保存在客户端里的键值对基本数据。当使用浏览器打开应用时，就可以对这些数据进行读写。</p> <p>创建 cookie，需要实例化一个 <code class="language-plaintext highlighter-rouge">javax.servlet.http.Cookie</code> 对象并且为它分配键值。实例化后，可以设置属性来配置 cookie。在这个例子里，我们使用 <code class="language-plaintext highlighter-rouge">setMaxAge()</code> 和 <code class="language-plaintext highlighter-rouge">setHttpOnly()</code> 方法来设置 cookie 的生命周期和防范客户端脚本。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span><span class="s">"sessionId"</span><span class="o">,</span><span class="s">"123456"</span><span class="o">);</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setHttpOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(-</span><span class="mi">30</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
</code></pre></div></div> <p>这里的 <code class="language-plaintext highlighter-rouge">response</code> 是传递给 <code class="language-plaintext highlighter-rouge">doXXX()</code> 方法的 <code class="language-plaintext highlighter-rouge">HttpServletResponse</code> 实例。</p> <p>读取服务端的 cookie 信息：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span><span class="o">(</span><span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">:</span> <span class="n">cookies</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">//cookie.getName();</span>
    <span class="c1">//cookie.getValue()</span>
<span class="o">}</span>
</code></pre></div></div> <p><br /> Happy Learning !!</p> <p><br /></p> <div class="post-tags"> <nav class="nav-post-tags-list"> <ul class="tags"> <li><a href="/tag/java/">Java</a></li> <li><a href="/tag/servlet/">Servlet</a></li> </ul> </nav> </div> </main> <footer> <hr class="footer-hr"> <div class="ui-flex"> <div class='wrapper-footer'> © 2023 Out of Memory.blog | <a href="mailto:yvens.fv@gmail.com">Yven Fong</a> </div> </div> </footer> </div> </body> </html>
