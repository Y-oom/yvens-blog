<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="/favicon.ico"> <title>[Java] java.lang.OutOfMemoryError - Out of Memory</title> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet"> <link rel="stylesheet" href="/assets/dist/css/style.css"> <!-- <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_big-stone.min.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_white.min.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-base16.dark.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-github.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[Java] java.lang.OutOfMemoryError | Out of Memory</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="[Java] java.lang.OutOfMemoryError" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="INDEX" /> <meta property="og:description" content="INDEX" /> <link rel="canonical" href="https://outofmemory.blog/outofmemoryerror-p5.html" /> <meta property="og:url" content="https://outofmemory.blog/outofmemoryerror-p5.html" /> <meta property="og:site_name" content="Out of Memory" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-03-08T00:00:00+08:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="[Java] java.lang.OutOfMemoryError" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-03-08T00:00:00+08:00","datePublished":"2018-03-08T00:00:00+08:00","description":"INDEX","headline":"[Java] java.lang.OutOfMemoryError","mainEntityOfPage":{"@type":"WebPage","@id":"https://outofmemory.blog/outofmemoryerror-p5.html"},"url":"https://outofmemory.blog/outofmemoryerror-p5.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="content"> <header> <div class="main"> <a href="https://outofmemory.blog/">Out of Memory</a> </div> <nav> <a class='' href="/">首页</a> <!-- <a class='' href="/archives.html"> Archives</a> --> <a class='' href="/about.html">关于</a> </nav> </header> <hr class="light-hr"> <main> <div class="title"> <h1 class="title">[Java] java.lang.OutOfMemoryError</h1> <div class="meta"> <time datetime="08-03-2018">Mar 08 2018</time> </div> </div> <hr class="no-margin light-hr "> <blockquote> <p><a href="/outofmemoryerror">INDEX</a></p> </blockquote> <h2 id="javalangoutofmemoryerror-unable-to-create-new-native-thread">java.lang.OutOfMemoryError: Unable to create new native thread</h2> <p>Java applications are multi-threaded by nature. What this means is that the programs written in Java can do several things (seemingly) at once. For example even on machines with just one processor while you drag content from one window to another, the movie played in the background does not stop just because you carry out several operations at once.</p> <p>A way to think about threads is to think of them as workers to whom you can submit tasks to carry out. If you had only one worker, he or she could only carry out one task at the time. But when you have a dozen workers at your disposal they can simultaneously fulfill several of your commands.</p> <p>Now, as with workers in physical world, threads within the JVM need some elbow room to carry out the work they are summoned to deal with. When there are more threads than there is room in memory we have built a foundation for a problem:</p> <center> <img style="border-radius: 0.3125em;box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" src="/assets/dist/images/nqhadl0g0.pic.png" /> <br /> </center> <p>The message <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> means that the Java application has hit the limit of how many Threads it can launch.</p> <h3 id="what-is-causing-it">What is causing it?</h3> <p>You have a chance to face the <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> whenever the JVM asks for a new thread from the OS. Whenever the underlying OS cannot allocate a new native thread, this OutOfMemoryError will be thrown. The exact limit for native threads is very platform-dependent thus we recommend to find out those limits by running a test similar to the below example. But, in general, the situation causing <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> goes through the following phases:</p> <ol> <li>A new Java thread is requested by an application running inside the JVM.</li> <li>JVM native code proxies the request to create a new native thread to the OS.</li> <li>The OS tries to create a new native thread which requires memory to be allocated to the thread.</li> <li>The OS will refuse native memory allocation either because the 32-bit Java process size has depleted its memory address space e.g. (2-4) GB process size limit has been hit or the virtual memory of the OS has been fully depleted.</li> <li>The <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> error is thrown.</li> </ol> <h3 id="give-me-an-example">Give me an example</h3> <p>The following example creates and starts new threads in a loop. When running the code, operating system limits are reached fast and <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> message is displayed.</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
    <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">(){</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">10000000</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>        
        <span class="o">}</span>    
    <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
  <span class="o">}</span> 
</code></pre></div></div> <p>The exact native thread limit is platform-dependent, for example tests on Windows, Linux and Mac OS X reveal that:</p> <ul> <li>64-bit Mac OS X 10.9, Java 1.7.0_45 – JVM dies after #2031 threads have been created.</li> <li>64-bit Ubuntu Linux, Java 1.7.0_45 – JVM dies after #31893 threads have been created.</li> <li>64-bit Windows 7, Java 1.7.0_45 – due to a different thread model used by the OS, this error seems not to be thrown on this particular platform. On thread #250,000 the process was still alive, even though the swap file had grown to 10GB and the application was facing extreme performance issues.</li> </ul> <p>So make sure you know your limits by invoking a small test and find out when the <code class="language-plaintext highlighter-rouge">java.lang.OutOfMemoryError: Unable to create new native thread</code> will be triggered</p> <h3 id="what-is-the-solution">What is the solution?</h3> <p>Occasionally you can bypass the Unable to create new native thread issue by increasing the limits at the OS level. For example, if you have limited the number of processes that the JVM can spawn in user space you should check out and possibly increase the limit:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>root@dev ~]# <span class="nb">ulimit</span> <span class="nt">-a</span>
core file size      <span class="o">(</span>blocks, <span class="nt">-c</span><span class="o">)</span> 0
...
max user processes  <span class="o">(</span><span class="nt">-u</span><span class="o">)</span> 1800
</code></pre></div></div> <p>More often than not, the limits on new native threads hit by the OutOfMemoryError indicate a programming error. When your application spawns thousands of threads then chances are that something has gone terribly wrong there are not many applications out there which would benefit from such a vast amount of threads.</p> <p>One way to solve the problem is to start taking thread dumps to understand the situation. You usually end up spending days doing this. Our suggestion is to connect Plumbr to your application to find out what is causing the problem and how to cure it in just minutes.</p> <div class="post-tags"> <nav class="nav-post-tags-list"> <ul class="tags"> <li><a href="/tag/java/">Java</a></li> <li><a href="/tag/oom/">OOM</a></li> <li><a href="/tag/jvm/">JVM</a></li> </ul> </nav> </div> </main> <footer> <hr class="footer-hr"> <div class="ui-flex"> <div class='wrapper-footer'> © 2025 Out of Memory.blog | <a href="mailto:yvens.fv@gmail.com">yvens</a> </div> </div> </footer> </div> </body> </html>
