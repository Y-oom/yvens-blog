<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link rel="shortcut icon" href="/favicon.ico"> <title>[IOT] Docker 部署 Home Assistant - Out of Memory</title> <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet"> <link rel="stylesheet" href="/assets/dist/css/style.css"> <!-- <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_big-stone.min.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/awsm.css/awsm_theme_white.min.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-base16.dark.css" media="(prefers-color-scheme: dark)"> <link rel="stylesheet" href="/assets/dist/rouge/syntax-github.css" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)"> --> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>[IOT] Docker 部署 Home Assistant | Out of Memory</title> <meta name="generator" content="Jekyll v3.10.0" /> <meta property="og:title" content="[IOT] Docker 部署 Home Assistant" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Home Assistant 是一个用 Python 开发的开源家居自动化平台，可以轻松集成各种智能设备和服务，并监控和管理。" /> <meta property="og:description" content="Home Assistant 是一个用 Python 开发的开源家居自动化平台，可以轻松集成各种智能设备和服务，并监控和管理。" /> <link rel="canonical" href="https://outofmemory.blog/deploy-home-assistant-via-docker.html" /> <meta property="og:url" content="https://outofmemory.blog/deploy-home-assistant-via-docker.html" /> <meta property="og:site_name" content="Out of Memory" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2024-06-07T00:00:00+08:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="[IOT] Docker 部署 Home Assistant" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-06-07T00:00:00+08:00","datePublished":"2024-06-07T00:00:00+08:00","description":"Home Assistant 是一个用 Python 开发的开源家居自动化平台，可以轻松集成各种智能设备和服务，并监控和管理。","headline":"[IOT] Docker 部署 Home Assistant","mainEntityOfPage":{"@type":"WebPage","@id":"https://outofmemory.blog/deploy-home-assistant-via-docker.html"},"url":"https://outofmemory.blog/deploy-home-assistant-via-docker.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <div class="content"> <header> <div class="main"> <a href="https://outofmemory.blog/">Out of Memory</a> </div> <nav> <a class='' href="/">首页</a> <!-- <a class='' href="/archives.html"> Archives</a> --> <a class='' href="/about.html">关于</a> </nav> </header> <hr class="light-hr"> <main> <div class="title"> <h1 class="title">[IOT] Docker 部署 Home Assistant</h1> <div class="meta"> <time datetime="07-06-2024">Jun 07 2024</time> </div> </div> <hr class="no-margin light-hr "> <p><a href="https://github.com/home-assistant/home-assistant.io" target="_blank">Home Assistant</a> 是一个用 Python 开发的<strong>开源</strong>家居自动化平台，可以轻松集成各种智能设备和服务，并监控和管理。</p> <p>主要特点：</p> <ul> <li><strong>兼容性</strong>：支持数千种智能设备和品牌，包括灯光、传感器、摄像头、开关、空调等等。它提供了丰富的集成选项，用户可以通过配置与多个设备相连。</li> <li><strong>自动化</strong>：用户可以创建复杂的自动化规则。例如，可以设置条件（如时间、传感器状态）来自动控制设备的行为，如在某个时间点自动开关灯。</li> <li><strong>本地控制</strong>：可以在本地部署运行，无需依赖云服务。这样可以提高隐私安全性，使设备的控制更加稳定和快速。</li> <li><strong>用户界面</strong>：它提供了一个直观的网页用户界面和移动端 App，用户可以通过它们查看设备状态，控制设备，并创建自动化规则。</li> <li><strong>社区支持</strong>：作为一个开源项目，它拥有活跃的开发者和用户社区，用户可以在社区中找到帮助、共享自定义配置和获取更新。</li> <li><strong>扩展性</strong>：用户可以通过编写自定义脚本和使用插件来扩展核心功能，以满足特定需求。</li> </ul> <p>Docker 的部署其实也很简单，我为了能远程控制设备，是部署在云服务器(Ubuntu)上的，使用 <code class="language-plaintext highlighter-rouge">docker compose</code>。</p> <p>下为简单的部署步骤：</p> <h3 id="创建-docker-composeyml-文件">创建 docker-compose.yml 文件</h3> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> docker/home-assistant/data  <span class="c"># 创建目录</span>
<span class="nv">$ </span><span class="nb">cd </span>docker/home-assistant
<span class="nv">$ </span>vim docker-compose.yml          <span class="c"># 创建文件</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">docker-compose.yml</code> 文件：</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">homeassistant</span><span class="pi">:</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">homeassistant</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">homeassistant/home-assistant:stable</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/home/ubuntu/docker/home-assistant/data:/config</span>   <span class="c1"># 映射到本地目录</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">TZ=Asia/Shanghai</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">network_mode</span><span class="pi">:</span> <span class="s">host</span>
</code></pre></div></div> <h3 id="拉取镜像并启动容器">拉取镜像并启动容器</h3> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>docker compose up <span class="nt">-d</span>
</code></pre></div></div> <p>稍等执行完成，不出意外的话容器应该能顺利启动。可以使用 <code class="language-plaintext highlighter-rouge">docker ps -a</code> 查看容器状态。</p> <h3 id="创建账号">创建账号</h3> <p>此时访问 <a href="http://localhost:8123" target="_blank">http://localhost:8123</a> 或 <a href="http://yourip:8123" target="_blank">http://yourip:8123</a> 应该就能访问到 Home Assistant 的主界面了。</p> <p>然后创建你的账号。</p> <h3 id="安装-hacs-home-asisstant-community-store">安装 HACS (Home Asisstant Community Store)</h3> <p>HACS 是一个插件，它提供了一个界面，让我们可以通过这个界面轻松地安装、更新和管理各种自定义组件、主题和插件等。</p> <p>可以在 <a href="https://github.com/hacs/integration/releases" target="_blank">GitHub</a> 下载你需要版本，一般直接选最新版就行了。</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> /home/ubuntu/docker/home-assistant/data    <span class="c"># 因为我上面把容器里的 /conf 映射到这个本地文件夹了，所以直接把文件放入这里就相当于放进了容器里</span>
<span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> custom_components/hacs         <span class="c"># 创建目录</span>
<span class="nv">$ </span><span class="nb">cd </span>custom_components/hacs
<span class="nv">$ </span>wget https://github.com/hacs/integration/releases/download/1.34.0/hacs.zip  <span class="c"># 下载 hacs，复制你需要的版本下载链接。如果服务器下载太慢的话，可以本地下载后传到服务器上</span>
<span class="nv">$ </span>unzip hacs.zip                          <span class="c"># 解压</span>
<span class="nv">$ </span><span class="nb">cd</span> /home/ubuntu/docker/home-assistant   <span class="c"># 进入 docker-compose.yml 所在目录</span>
<span class="nv">$ </span><span class="nb">sudo </span>docker compose restart             <span class="c"># 重启容器</span>
</code></pre></div></div> <h3 id="集成-hacs">集成 HACS</h3> <p>重新进入 Home Assistant 主界面后，左下角 <strong>设置</strong> » 选择 <strong>设备与服务</strong> » 右下角 <strong>添加集成</strong> » 弹出窗口中搜索 HACS » 全部勾选后点击提交</p> <p>这时 HACS 会请求 GitHub 关联账号，如果长时间转圈之后提示 <code class="language-plaintext highlighter-rouge">could_not_register</code>，这通常是网络问题。查看日志（容器映射路径下的 <code class="language-plaintext highlighter-rouge">home-assistant.log</code> 文件），可能会有类似输出：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
aiogithubapi.exceptions.GitHubConnectionException: Request exception for 'https://github.com/login/device/code' with - Server disconnected
ERROR (MainThread) [custom_components.hacs] Timeout of 20 reached while waiting for https://github.com/login/device/code
...
</code></pre></div></div> <p>这时如果能 <code class="language-plaintext highlighter-rouge">ping</code> 通 github.com，那么上面集成 HACS 的步骤多试几次应该就行了。</p> <p>安装成功后，刷新页面就能在左边的主菜单看到 HACS 了。</p> <div class="post-tags"> <nav class="nav-post-tags-list"> <ul class="tags"> <li><a href="/tag/docker/">Docker</a></li> <li><a href="/tag/ubuntu/">Ubuntu</a></li> <li><a href="/tag/iot/">IOT</a></li> </ul> </nav> </div> </main> <footer> <hr class="footer-hr"> <div class="ui-flex"> <div class='wrapper-footer'> © 2025 Out of Memory.blog | <a href="mailto:yvens.fv@gmail.com">Yven Fong</a> </div> </div> </footer> </div> </body> </html>
